var Controller;Controller={ingest:function(b){var a;if(this.options.competition==b.competition){if(this.__loading){this.__lastMessage=b}else{a=Model.put(b);if(a&&a.length){console.error("\n++++++++ MESSAGE ++++++++\n"+JSON.stringify(b,undefined,1)+"\n++++++++ END MESSAGE ++++++++\n")}}}},modelInserted:function(a){View.inserted(a);if(this.__highestRound!=-1){View.reordered(this.options.containers.rounds+"."+this.__highestRound)}if(this.options.containers.navigation&&this.options.containers.navigation.length){View.inserted(this.options.containers.navigation)}if(!this.__swipeView){if(Controller.options.containers.swipe){Controller.__swipeView=new Swipe(document.getElementById(Controller.options.containers.swipe),Controller.options.swipeOptions)}}else{this.__swipeView.setup()}if(this.__swipeView){this.__swipeTime()}else{if(Controller.options.containers.remove){$("#"+Controller.options.containers.remove).remove();Controller.options.containers.remove=null}}},modelReordered:function(){},modelUpdated:function(a){View.updated(a)},request:function(d,c,b){if(!(c&&c.length)){c="rounds"}if(!(b&&b.length)){b="data"}var a=Controller.options.endpoint+d+"/"+c;Controller.__requestKey=b;$.ajax({url:a,dataType:"json",success:function(g,e,f){Model.put(g,Controller.__requestKey);Controller.__loading=false;if(Controller.__lastMessage){Model.put(Controller.__lastMessage);Controller.__lastMessage=null}}})},setOptions:function(a){$.extend(true,this.options,a);if(!this.__initialized){this.__initialize()}return this},viewCount:function(b){var c,d,a;c=0;d=b.split(".");switch(d[d.length-1]){case this.options.containers.navigation:c=Model.rounds.length;break;default:a=Model.find(d);c=a.length}return c},viewInserted:function(c,b){var d,g,f,e,a;f=c.split(".");g=f.pop();d=false;a=false;switch(g){case this.options.containers.score:if(!this.options.scoreOptions.width){e=b.width();e=Number(e);this.options.scoreOptions.width=e}break;case this.options.containers.competitorBtnYay:case this.options.containers.competitorBtnNay:d=true;break;case this.options.containers.judgeMeterYay:b.data("yay",true);case this.options.containers.judgeMeterNay:a=true;d=true;break;case this.options.containers.competitorMeterYay:b.data("yay",true);case this.options.containers.competitorMeterNay:a=true;break;case this.options.containers.navigation:if(!this.options.navigationOptions.pageOff){this.options.navigationOptions.pageOff=b.attr("class")}d=true;break;case this.options.containers.completed:case this.options.containers.link:case this.options.containers.judgeBtnNay:case this.options.containers.judgeBtnYay:d=true}if(a){b.data("index",c.replace(/\./g,""))}if(d||(b.length&&(b[0].tagName=="A"))){b.click({path:c},this.__click)}},viewUpdated:function(a,f){var p,o,i,c,j,l,m,k,e,d,b,h,n,g;p=this.options;o=p.scoreOptions;i=Model.options;c=p.containers;m=a.split(".");l=m.pop();j=Number(m.pop());d=Model.find(a);if(l==c.navigation){f.attr("class",p.navigationOptions["page"+((this.__displayedRound==j)?"On":"Off")])}else{if(d){g=(d.round!=Model.round);switch(l){case c.completed:f.attr("class",(this.__roundDataCompleted(d.round.id)?p.popupOptions.active:p.popupOptions.inactive));break;case"index":f.val(1+j);break;case c.score:e=d.getModelData(o.key);e=e/o.max;e=e*o.width;f.width(e+"px");break;case c.roundHide:f.toggle(g);break;case c.competitorMeterYay:case c.competitorMeterNay:d=d.competitor;case c.judgeMeterYay:case c.judgeMeterNay:n=d.getPercentage();if(g){this.__animationTagDraw(f,true,n)}else{if((n!=f.data("percentage"))){f.data("target",n);this.__animationStart(f)}}break;case c.competitorBtnYay:case c.competitorBtnNay:k=(l==c.competitorBtnYay);b=(k?i.competitorKeyYay:i.competitorKeyNay);e=this.__roundDataGet(d.competitor.id+"."+b,d.round.id);f.val(e);case c.link:if(e==undefined){e=d.getModelData(c.link);g=!(e&&e.length)}case c.judgeBtnNay:case c.judgeBtnYay:if(g==Boolean(f.data("enabled"))){f.data("enabled",!g);if(g){f.attr("disabled","disabled")}else{f.removeAttr("disabled")}}break;case i.competitorKeyYay:case i.competitorKeyNay:h=d.getModelData(l);if(h!=undefined){h=Number(h);if(h>9999){if(h>9999999){h=this.__addCommas((h/1000000).toFixed(3))+"M"}else{h=this.__addCommas(h)}}f.val(h)}break;case c.competitorName:case c.judgeName:l="name";default:if(f.length){b=f[0].tagName;switch(b){case"INPUT":h=d.getModelData(l);if(h!=undefined){f.val(h)}break;case"IMG":h=f.width();n=f.height();if(window.devicePixelRatio>=2){h*=2;n*=2}h=h+"x"+n;f.attr("src",p.endpoint+d.getModelData("id")+"/picture/"+h);break}}else{console.error("Controller.viewUpdated: UNFOUND "+a)}}}}},__addCommas:function(b){b+="";x=b.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var a=/(\d+)(\d{3})/;while(a.test(x1)){x1=x1.replace(a,"$1,$2")}return x1+x2},__animationStop:function(a){if(a.data("animating")){var b=this.__animations.indexOf(a);if(b>-1){this.__animations.splice(b,1);if(!this.__animations.length){clearInterval(this.__animating)}}a.data("animating",false)}},__animationStart:function(a){if(!a.data("animating")){a.data("animating",true);if(!this.__animations.length){this.__animating=setInterval(this.__animate,50)}this.__animations.push(a)}},__animate:function(){var b,c,a;c=Controller.__animations.length;for(b=c-1;b>-1;b--){a=Controller.__animations[b];Controller.__animationTagDraw(a,false,a.data("target"))}},__animationTagDraw:function(r,e,i){var k,l,f,o,q,j,g,c,b,p,a,m;b=r.data("yay");m=(e?i:r.data("percentage"));if(m==undefined){m=50}if(m<i){m=Math.min(m+1,i)}else{if(m>i){m=Math.max(m-1,i)}}r.data("percentage",m);if(i==m){Controller.__animationStop(r)}if(b){p=r.css("width");l=Number(p.substr(0,p.length-2));p=r.css("border-left-width");a=Number(p.substr(0,p.length-2));l+=a;p=r.css("border-right-width");a=Number(p.substr(0,p.length-2));l+=a;p=r.css("padding-left");a=Number(p.substr(0,p.length-2));l+=a;p=r.css("padding-right");a=Number(p.substr(0,p.length-2));l+=a;c=l/10;c=Math.min(c,Math.max(-c,m-i));p=r.css("height");f=Number(p.substr(0,p.length-2));p=r.css("border-top-width");a=Number(p.substr(0,p.length-2));f+=a;p=r.css("border-bottom-width");a=Number(p.substr(0,p.length-2));f+=a;p=r.css("padding-top");a=Number(p.substr(0,p.length-2));f+=a;p=r.css("padding-bottom");a=Number(p.substr(0,p.length-2));f+=a;k=0;j=Math.round((m*l)/100);if(!b){k=l;j=-j}q=r.data("index");o=document.getCSSCanvasContext("2d",q,l,f);o.clearRect(0,0,l,f);o.beginPath();o.moveTo(k,0);o.lineTo(k+j,0);if(Math.abs(c)>1){o.lineTo(k+j-c,f/2)}o.lineTo(k+j,f);o.lineTo(k,f);o.closePath();o.setFillColor("black");o.fill();r.attr("style","-webkit-mask-image:-webkit-canvas("+q+");")}else{m=100-m}if(m<50){m=""}else{if((m==50)&&(!b)){m=""}else{m+="%"}}r.val(m)},__click:function(b){var l,d,g,h,a,m,k,j,i,e,c,f;i=Controller.options;e=Model.options;c=i.containers;f=i.insightsOptions;m=b.data.path;l=m.split(".");g=l.pop();m=l.join(".");d=Model.find(m);h=Number(l.pop());switch(g){case c.competitorBtnNay:case c.competitorBtnYay:if(d&&d.competitor){d=d.competitor;a=(g==c.competitorBtnYay);k=(a?e.competitorKeyYay:e.competitorKeyNay);d.incrementModelData(k);j=Controller.__roundDataGet(d.id+"."+k);j++;Controller.__roundDataSet(d.id+"."+k,j);if(!Controller.__roundDataGet(d.id)){Controller.__roundDataSet(d.id,1);if(Controller.__roundDataCompleted()){View.updated(m+"."+c.completed)}}View.updated(m+"."+(a?c.competitorBtnYay:c.competitorBtnNay));View.updated(m+"."+c.competitorMeterYay);View.updated(m+"."+c.competitorMeterNay);Controller.__vote(d.round,a);k=(a?f.tapCheer:f.tapBoo);Controller.__insights(k,encodeURI(d.getModelData("name")))}break;case c.judgeBtnNay:case c.judgeBtnYay:a=(g==c.judgeBtnYay);k=(a?e.judgeKeyYay:e.judgeKeyNay);d.incrementModelData(k);if(!Controller.__roundDataGet(d.id)){Controller.__roundDataSet(d.id,1);if(Controller.__roundDataCompleted()){l.pop();View.updated(l.join(".")+"."+c.completed)}}View.updated(m+"."+c.judgeMeterYay);View.updated(m+"."+c.judgeMeterNay);Controller.__vote(d,a);k=(a?f.tapAgree:f.tapDisagree);Controller.__insights(k,encodeURIComponent(d.round.competitor.getModelData("name")),"",encodeURIComponent(d.getModelData("name")));break;case c.completed:Controller.__popOver.toggle(true);break;case c.link:Controller.__insights(f.tapItunes,d.getModelData("id"),encodeURI(d.getModelData("what")));window.location.href=d.getModelData(g);break;case c.navigation:Controller.__navigating=true;Controller.__insights(f.navigateTap,Model.rounds[Controller.__displayedRound].getModelData("id"),Model.rounds[h].getModelData("id"));Controller.__swipeView.slide(h);break;default:console.error("Controller.__click: UNKNOWN "+g)}},__clickPopover:function(a){Controller.__popOver.toggle(false)},__initialize:function(){Model.setOptions(this.options.modelOptions,this);View.setOptions(this.options.viewOptions,this);__initialized=true;Controller.__insights(Controller.options.insightsOptions.loadedApp,"web-app","1.0.1");Controller.__popOver=$("#"+Controller.options.containers.cardCompleted);Controller.__popOver.click(Controller.__clickPopover);Controller.__clickPopover()},__insights:function(a,i,f,e,c){if(!i){i=""}if(!f){f=""}if(!e){e=""}if(!c){c=""}var d=new Date();var g=new Date(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds());var b=this.options.insightsOptions.endpoint;var h=[];h.push(this.options.insightsOptions.userIdentifier);h.push(this.options.insightsOptions.sessionIdentifier);h.push("");h.push(this.options.insightsOptions.context);h.push("");h.push("");h.push(a);h.push(g.getTime());h.push(i);h.push(f);h.push(e);h.push(c);h.push("");h.push("");h.push("");h.push("");h=h.join("||");$.ajax({type:"POST",url:b,data:{event:h},dataType:"json"})},__navigationSwitch:function(a){var b=Controller.options.containers.navigation;var c=Controller.__displayedRound;Controller.__displayedRound=a;View.updated(b+"."+c+"."+b);View.updated(b+"."+Controller.__displayedRound+"."+b)},__roundData:function(b){var a=localStorage.getItem(b);if(a&&a.length){a=JSON.parse(a)}return a},__roundDataCompleted:function(e){var c,d,b;c=false;if(!e){e=Model.round.id}var a=Model.roundFromId(e);if(a){if(this.__roundDataGet(a.competitor.id,e)){c=true;d=a.judges.length;for(b=0;b<d;b++){if(!this.__roundDataGet(a.judges[b].id,e)){c=false;break}}}}return c},__roundDataGet:function(b,d){if(!d){d=Model.round.id}var c,a;c=0;a=Controller.__roundData(d);if(a&&a[b]){c=a[b]}return c},__roundDataSet:function(b,c){var a,d;d=Model.round.id;a=Controller.__roundData(d);if(!a){a={}}a[b]=c;localStorage.setItem(d,JSON.stringify(a,undefined,1))},__swipeTime:function(){if(!this.__swipeInterval){this.__swipeInterval=setInterval(this.__swipeTimed,100)}},__swipeTimed:function(){if(Controller.__highestRound!=(Model.rounds.length-1)){Controller.__highestRound=Model.rounds.length-1}else{clearInterval(Controller.__swipeInterval);Controller.__swipeInterval=false;var a=Controller.__highestRound;if(Controller.__swipeView){if(Controller.options.containers.remove){a++}Controller.__clickPopover();Controller.__swipeView.slide(a)}}},__vote:function(b,c){var a=this.options.endpoint;a+=b.round.id+"/";a+=b.getModelData("id")+"/";a+=(c?"cheer":"boo");$.ajax(a,{type:"POST"})},options:{competition:"",endpoint:"",containers:{},viewOptions:{data:{}},insightsOptions:{context:3000,tapItunes:6001,tapBoo:6002,tapCheer:6003,tapAgree:6004,tapDisagree:6005,loadedApp:6000,loadedCard:6006,navigateTap:6007,navigateSwipe:6008,endpoint:"http://insightsprod.zelfy.com/insights/rlog",userIdentifier:"",sessionIdentifier:"",accessToken:""},popupOptions:{},swipeOptions:{callback:function(a,b){if(Controller.options.containers.remove){a--}else{if(!Controller.__navigating){Controller.__insights(Controller.options.insightsOptions.navigateSwipe,Model.rounds[Controller.__displayedRound].getModelData("id"),Model.rounds[a].getModelData("id"))}}Controller.__navigationSwitch(a)},transitionEnd:function(a,b){if(Controller.options.containers.remove){$("#"+Controller.options.containers.remove).remove();Controller.options.containers.remove=null;a--;Controller.__swipeView.setup();Controller.__swipeView.slide(a)}Controller.__insights(Controller.options.insightsOptions.loadedCard,encodeURI(Model.rounds[a].competitor.getModelData("name")))},speed:300,continuous:true},scoreOptions:{key:"score",max:1},modelOptions:{}},__lastMessage:null,__highestRound:-1,__navigating:false,__loading:true,__animating:0,__displayedRound:0,__animations:[],__initialized:false,__swipeView:null,__swipeInterval:0};