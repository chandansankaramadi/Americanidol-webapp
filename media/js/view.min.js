var View;View={controller:null,reordered:function(f){var d,g,e,c,a,b;if(f){f=f.split(".");a=f.shift();if(f.length){b=f.shift()}}if(this.options instanceof Array){c=this.options}else{c=[this.options]}g=c.length;for(d=0;d<g;d++){e=c[d];if((!a)||(e.container==a)){this.__reordered(e.container,e,b)}}},__reordered:function(l,m,d){var c,f,g,b,k,e,a,h;f=this.__getTemplateCount(l);for(c=0;c<f;c++){if((d!=null)&&(c!=d)){continue}k=this.__getTemplate(l,c);for(h in k.fields){this.updated(l+"."+c+"."+h)}e=m.viewOptions;if(e){if(!(e instanceof Array)){e=[e]}g=e.length;for(b=0;b<g;b++){a=e[b];this.__reordered(l+"."+c+"."+a.container,a)}}}},inserted:function(c){var b,a;b=this.__topOptions(c);if(b&&b.container&&b.container.length){this.__inserted(c,this.__topContainers[b.container],b)}else{console.error("View.inserted: "+b)}},updated:function(b){var a=this.__pathInfo(b);if(!(a&&a.template&&a.template.fields)){console.log("View.updated: UNFOUND "+b)}else{if(a.template.fields[a.field]){this.controller.viewUpdated(b,a.template.fields[a.field])}else{this.controller.viewUpdated(b,a.template.tag)}}},setOptions:function(d,b){this.controller=b;var c,e,f,a;if(d instanceof Array){this.options=[];f=d.length;for(e=0;e<f;e++){this.options[e]={};$.extend(true,this.options[e],d[e]);a=this.options[e].container;if(a&&a.length){this.__topContainers[a]=$("#"+a)}}}else{this.options={};$.extend(true,this.options,d);a=this.options.container;if(a&&a.length){this.__topContainers[a]=$("#"+a)}}if(!this.__initialized){this.__initialize()}},__topContainer:function(c){var b,a;b=this.__topOptions(c);if(b&&b.container&&b.container.length){a=this.__topContainers[b.container]}return a},__topOptions:function(e){var a,f,b,c,d;if(!(this.options instanceof Array)){b=this.options}else{c=e.split(".");d=c.shift();f=this.options.length;for(a=0;a<f;a++){b=this.options[a];if(d==b.container){break}b=null}}return b},__topContainers:{},options:null,__addTemplate:function(b,a){if(this.__templates[b]==null){this.__templates[b]=[]}this.__templates[b].push(a)},__createTemplate:function(f,b){var e,c,g,d,a;e={};if(!this.__originalTemplates[f]){console.error("__createTemplate not found "+f)}else{e.tag=this.__originalTemplates[f].clone();e.fields=this.__findTemplateFields(e.tag,b.fields);e.containers=[];e.container=b.container;e.ids=[];b=b.viewOptions;if(b){if(!(b instanceof Array)){b=[b]}g=b.length;for(c=0;c<g;c++){d=b[c];if(d.container){a=e.tag.find("#"+d.container);if(a.length){if(a.attr("class")==undefined){a.attr("class",d.container)}a.removeAttr("id");e.ids.push(d.container);e.containers.push(a)}else{console.error("View.__createTemplate: UNFOUND "+d.container)}}}}}return e},__findTemplateFields:function(c,b){var d={};var e,a;if(b&&b.length){z=b.length;for(i=0;i<z;i++){e=b[i];a=c.find("#"+e);if(a.attr("class")==undefined){a.attr("class",e)}a.removeAttr("id");d[e]=a}}return d},__inserted:function(q,a,r){var e,l,f,h,k,o,d,g,c,p,n,m,b;c=this.__templatePath(q);e=this.__getTemplateCount(q);l=this.controller.viewCount(q);if(e>=l){console.warn("View.__inserted: "+q+" have "+e+" need "+l)}for(;e<l;e++){k=q+"."+e;p=this.__createTemplate(c,r);this.__addTemplate(q,p);a.append(p.tag);if(r.viewOptions){g=r.viewOptions;if(!(g instanceof Array)){g=[g]}h=g.length;for(f=0;f<h;f++){d=g[f];n=p.ids[f];o=p.containers[f];this.__inserted(k+"."+n,o,d)}}b=false;for(m in p.fields){b={};b.template=p;b.index=e;b.field=m;b.path=q;if(!p.fields[m]){console.error("View.__inserted: UNFOUND "+m)}else{this.controller.viewInserted(k+"."+m,p.fields[m]);this.controller.viewUpdated(k+"."+m,p.fields[m])}}this.controller.viewInserted(k+"."+r.container,p.tag);if(!b){this.controller.viewUpdated(k+"."+r.container,p.tag)}}},__pathInfo:function(e){var d,c,a,b;d={};c=e.split(".");a=c.pop();b=Number(a);if(isNaN(b)){d.field=a;a=c.pop();b=Number(a)}if(!isNaN(b)){d.index=b;d.path=c.join(".");d.template=this.__getTemplate(d.path,b)}return d},__getTemplate:function(b,a){if((this.__templates!=null)&&(this.__templates[b]!=null)&&(a<this.__templates[b].length)){return this.__templates[b][a]}return null},__getTemplateCount:function(b){var a=0;if((this.__templates!=null)&&(this.__templates[b]!=null)){a=this.__templates[b].length}return a},__grabTemplates:function(b,e){if(b instanceof Array){var c,f;f=b.length;for(c=0;c<f;c++){this.__grabTemplates(b[c],e)}}else{var d=$("#"+b.template);var a=(e?e+"."+b.container:b.container);this.__originalTemplates[a]=d;if(b.viewOptions&&b.viewOptions){this.__grabTemplates(b.viewOptions,a)}if(d.attr("class")==undefined){d.attr("class",b.template)}d.removeAttr("id");d.remove()}},__initialize:function(){this.__grabTemplates(this.options);__initialized=true},__templatePath:function(d){var c=d.split(".");var b=[];var a,e;e=c.length;for(a=0;a<e;a++){if(isNaN(Number(c[a]))){b.push(c[a])}}return b.join(".")},__templates:{},__originalTemplates:{},__initialized:false};