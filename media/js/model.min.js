var Model;Model={controller:null,rounds:[],round:null,find:function(d){if(!(d instanceof Array)){d=d.split(".")}else{d=d.slice()}var c,b,a;c=null;if(d.length){a=d.shift();if(a==this.options.rounds){c=this.rounds;if(d.length){b=Number(d.shift());if(!isNaN(b)){c=c[b];if(d.length){a=d.shift();if(a==this.options.judges){c=c.judges;b=Number(d.shift());if(!isNaN(b)){c=c[b]}}}}}}}return c},get:function(c){if(!(c instanceof Array)){c=c.split(".")}var b=c.pop();var a=this.find(c);return a.getModelData(b)},put:function(g,n){var f,b,m,l,h,j,k,a;f="";if(!g){f="no data"}if(!f.length){if(n&&n.length){l=n.split(".");while(g&&(k=l.shift())){g=g[k]}}if(!g){f='invalid key: "'+n+'"'}if(!f.length){if(!(g instanceof Array)){g=[g]}j=g.length;a=false;var c=[];var e=[];var d=0;for(h=0;((!f.length)&&(h<j));h++){m=g[h];if(!m){f="found no data in array at "+h}if(!f.length){b=m.id;if(!(b&&b.length)){f="invalid identifier"}}if(!f.length){k=this.roundFromId(b);if(k==null){k=this.__factory(m);if(!(k instanceof Object)){console.warn("Model.put: "+k)}else{d++;a=true}}else{c.push(k);e.push(m)}}}if(a&&this.options.sortKey&&this.options.sortKey.length){this.__sortRounds()}this.round=this.rounds[this.rounds.length-1];if(d){this.controller.modelInserted(Model.options.rounds)}j=e.length;for(h=0;h<j;h++){k=c[h];m=e[h];k.update(m)}}}return f},roundFromId:function(d){var a,b,c;c=this.rounds.length;for(b=0;b<c;b++){if(this.rounds[b].id==d){a=this.rounds[b];break}}return a},setOptions:function(b,a){this.controller=a;$.extend(true,this.options,b);if(!this.__initialized){this.__initialize()}},__sortRounds:function(){var b,a;b=function(k,j){var f,g,e,c,m,d,l,h;m=Model.options.sortKey.split(".");d=((Model.options.sortOrder=="desc")?-1:1);l=((Model.options.sortOrder=="desc")?1:-1);e=k.__data;c=j.__data;g=m.length;for(f=0;f<g;f++){h=m[f];e=e[h];c=c[h];if(e==null){return((c==null)?0:l)}if(c==null){return d}}if(Model.options.sortType=="numeric"){e=Number(e);c=Number(c);if(e>c){return d}if(e<c){return l}}else{switch(e.localeCompare(c)){case -1:return l;case 1:return d}}return 0};a=this.rounds.slice();this.rounds.sort(b);if(a!=this.rounds){this.controller.modelReordered()}},__factory:function(a){var b;b=new this.__round(a);if(b){if(b.error.length){b=b.error}else{this.rounds.push(b)}}return b},__initialize:function(){this.__participant.prototype.updateData=function(c){var a;var b={};for(a in c){if((a=="id")||(a=="type")){continue}if(this.setModelData(a,c[a])){if(this.isCompetitor){switch(a){case Model.options.competitorKeyNay:case Model.options.competitorKeyYay:b[Model.options.competitorMeterNay]=true;b[Model.options.competitorMeterYay]=true;default:b[a]=true}}else{switch(a){case Model.options.judgeKeyNay:case Model.options.judgeKeyYay:b[Model.options.judgeMeterNay]=true;b[Model.options.judgeMeterYay]=true;default:b[a]=true}}}}for(a in b){Model.controller.modelUpdated(this.getPath(a))}};this.__participant.prototype.getModelData=function(a){return this.__data[a]};this.__participant.prototype.getPath=function(a){var b=this.round.getPath();if(!this.isCompetitor){b+="."+Model.options.judges+"."+this.round.judges.indexOf(this)}if(a&&a.length){b+="."+a}return b};this.__participant.prototype.setModelData=this.__setData;this.__participant.prototype.getPercentage=this.__getPercentage;this.__participant.prototype.incrementModelData=this.__incrementData;this.__participant.prototype.id="";this.__participant.prototype.isCompetitor=false;this.__participant.prototype.round=null;this.__participant.prototype.__data=null;this.__round.prototype.id="";this.__round.prototype.error="";this.__round.prototype.judges=null;this.__round.prototype.competitor=null;this.__round.prototype.__data=null;this.__round.prototype.getModelData=function(a){return((this.competitor.__data[a]==null)?this.__data[a]:this.competitor.__data[a])};this.__round.prototype.updateData=function(c){var a;var b={};for(a in c){switch(a){case"id":case"participants":break;default:if(this.setModelData(a,c[a])){b[a]=true}}}for(a in b){Model.controller.modelUpdated(this.getPath(a))}};this.__round.prototype.update=function(d){var c,e,b,a;this.updateData(d);e=d.participants.length;for(c=0;c<e;c++){b=null;a=d.participants[c];switch(a.type){case Model.options.judge:b=this.judgeFromId(a.id);break;case Model.options.competitor:if(this.competitor.getModelData("id")==a.id){b=this.competitor}break}if(b!=null){b.updateData(a)}}};this.__round.prototype.judgeFromId=function(d){var b,c,a;if(this.judges){c=this.judges.length;for(b=0;b<c;b++){if(this.judges[b].id==d){a=this.judges[b];break}}}return a};this.__round.prototype.participantsOfType=function(d){var b=[];var c,e,a;if(this.__data&&this.__data.participants){if((d==null)||(!d.length)){d=Model.options.judge}e=this.__data.participants.length;for(c=0;c<e;c++){a=this.__data.participants[c];if(a.type==d){b.push(a)}}}return b};this.__round.prototype.getPath=function(a){var b=Model.options.rounds+"."+Model.rounds.indexOf(this);if(a&&a.length){b+="."+a}return b};this.__round.prototype.round=null;this.__round.prototype.getPercentage=this.__getPercentage;this.__round.prototype.setModelData=this.__setData;this.__initialized=true},__participant:function(c,a,b){this.isCompetitor=b;this.__data=c;this.id=c.id;this.round=a},__round:function(e){this.isCompetitor=true;this.judges=[];this.round=this;this.__data=e;this.id=e.id;var d,b,c,a;d=[];b=[];switch(this.__data.type){case Model.options.competitor:d.push(e);break;case Model.options.judge:b.push(e);break}if(!b.length){b=this.participantsOfType(Model.options.judge)}c=b.length;for(a=0;a<c;a++){this.judges.push(new Model.__participant(b[a],this,false))}if(Model.__judgeCount==-1){Model.__judgeCount=this.judges.length}else{if(Model.__judgeCount!=this.judges.length){this.error="wrong number of judges, needed "+Model.__judgeCount}}if(!d.length){d=this.participantsOfType(Model.options.competitor)}c=d.length;if(c){this.competitor=new Model.__participant(d.shift(),this,true)}else{this.error="no competitor for round "+this.id}},__setData:function(a,b){var c=(this.__data[a]!=b);if(c){this.__data[a]=b}return c},__getPercentage:function(){var b,a,e,d,c;a=(this.isCompetitor?Model.options.competitorKeyNay:Model.options.judgeKeyNay);e=(this.isCompetitor?Model.options.competitorKeyYay:Model.options.judgeKeyYay);c=Number(this.getModelData(a));d=Number(this.getModelData(e));if(isNaN(c)){c=0}if(isNaN(d)){d=0}b=((c!=d)?Math.round(d*100/(c+d)):50);return b},__incrementData:function(a){var b=this.getModelData(a);if(!b){b=0}else{b=Number(b);if(isNaN(b)){b=0}}this.setModelData(a,b+1)},__judgeCount:-1,__initialized:false,options:{competitorKeyNay:"totalBoos",competitorKeyYay:"totalCheers",judgeKeyNay:"totalBoos",judgeKeyYay:"totalCheers",competitorMeterNay:"competitor_meter_nay",competitorMeterYay:"competitor_meter_yay",judgeMeterNay:"judge_meter_nay",judgeMeterYay:"judge_meter_yay",competitor:"competitor",judge:"judge",judges:"judges",rounds:"rounds",sortKey:"",sortOrder:"asc",sortType:"numeric",voting:"voting"}};